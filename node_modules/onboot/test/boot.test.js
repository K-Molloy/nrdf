var test = require('tape');
var boot = require('../');

test('boot immediately', function (test) {
  test.plan(1);

  boot.up(function () {
    test.ok(true, 'application booted');
  });
});

test('boot after bootstrap', function (test) {
  test.plan(2);

  var laced = false;

  boot.strap(function () {
    test.ok(true, 'boot strap function called');
    laced = true;
  });

  boot.up(function () {
    test.ok(laced, 'application booted after lace up');
  });
});


test('boot after async bootstrap', function (test) {
  test.plan(2);

  var laced = false;

  boot.strap(function (done) {
    test.ok(true, 'boot strap function called');
    setTimeout(function () {
      laced = true;
      done();
    }, 100);
  });

  boot.up(function () {
    test.ok(laced, 'application booted after lace up');
  });
});

test('bootstrap can\'t call done more than once', function (test) {
  test.plan(3);

  var laced = false;

  boot.strap(function (done) {
    test.ok(true, 'boot strap function called');
    setTimeout(function () {
      laced = true;
      done();

      try {
        done();
      } catch (e) {
        test.ok(e.message === 'done called multiple times', 'prevented done call');
      }
    }, 100);
  });

  boot.up(function () {
    test.ok(laced, 'application booted after lace up');
  });
});
